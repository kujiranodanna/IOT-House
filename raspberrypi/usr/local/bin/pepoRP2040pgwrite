#!/bin/sh
# The MIT License
# Copyright (c) 2022-2027 Isamu.Yamauchi , 2025.12.26 update 2025.12.31
####################################################################################
# What's this?
# This script writes about 300 lines of RP2040 program.
# This program requires epicon.
# Please install it by following the instructions below.
# https://github.com/kujiranodanna/epicon
####################################################################################
DIR=/www/remote-hand/tmp
prog=pepoRP2040pgwrite
pid=`echo -n $$`
CMD="${DIR}/$prog.cmd"
RPICMD="${DIR}/RP2040.cmd"
DIO_DEV=/dev/ttyACM0
EPICON_TTY_LOCK="/var/lock/LCK..ttyacm0"
EPICON_SOCKET="/var/lock/epicon_socket.*"
CMD_DIO="/usr/local/bin/epicon -ql ${DIO_DEV} -s 115200 -d 5 -D 50 -c ${CMD}"
rm -f /var/lock/epicon_socket.*
rm -f /var/lock/LCK..ttyacm0
 
cat >${CMD}<<END
#!/bin/sh
#cat >${RPICMD}<<EOF
echo
# Send Ctl-C ,Break
printf "\003"
msleep 2000
# Send Ctl-E , Copy & Paste Mode
printf "\005"
echo
msleep 2000
cat <<EOF

########### Please write the RP2040 program below. ###########

import time
from machine import Pin
import rp2
etc.
.


########### Please write the RP2040 program above this. ###########

EOF

msleep 1000
# Send  Ctl-D, Copy & Paste Mode Release
printf "\004"

msleep 2000
echo
echo
END
chmod +x ${CMD}
${CMD}
rm -f $EPICON_TTY_LOCK
rm -f $EPICON_SOCKET
echo RP2040 Program Writer Start
${CMD_DIO}
rm -f ${RPICMD} ${CMD}
echo RP2040 Program Writer End
exit
