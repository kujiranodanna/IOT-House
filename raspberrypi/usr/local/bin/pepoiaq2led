#!/bin/bash
# The MIT License
# Copyright (c) 2020-2027 Isamu.Yamauchi , 2019.6.16 update 2022.2.22
# Scan GPIO IAQ & LED Display for rasberry pi zero W.
# pepoiaq2led
# Connect physical Pin 13 ->Red Led, Pin 14 ->Green Led
DIR=/www/remote-hand/tmp
GPIOGPIORD=$DIR/.gpiodi_read_data
GPIOGPIOWD=$DIR/.gpiodo_write_data
DEEP=3000
LIGHT=1500
DSLEEP="/usr/local/bin/msleep $DEEP"
LSLEEP="/usr/local/bin/msleep $LIGHT"
GPIOCMD="/usr/local/bin/pepogpioctl b"
BLACK="$GPIOCMD 0"
GREEN="$GPIOCMD 10"
RED="$GPIOCMD 20"
YELLOW="$GPIOCMD 30"

while true;do
  if [ -e $GPIOGPIORD ];then
    . $GPIOGPIOWD
    IAQ=`cat $GPIOGPIORD|awk 'BEGIN{FS=","};{printf $6}'`
    IAQ_COLOR=$GREEN
    if [ $IAQ -lt 51 ];then
      IAQ_COLOR=$GREEN
    elif [ $IAQ -lt 101 ];then
      IAQ_COLOR=$GREEN
    elif [ $IAQ -lt 151 ];then
      IAQ_COLOR=$YELLOW
    elif [ $IAQ -lt 201 ];then
      IAQ_COLOR=$YELLOW
    elif [ $IAQ -lt 301 ];then
      IAQ_COLOR=$RED
    else
      IAQ_COLOR=$RED
    fi
    $IAQ_COLOR
    $LSLEEP
    $GPIOCMD $BLACK
  fi
  $DSLEEP
done
